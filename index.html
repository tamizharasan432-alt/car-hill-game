<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>F1 Hill Climb Racing - Infinite Edition</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

body {
  overflow: hidden;
  font-family: 'Arial', sans-serif;
  background: #000;
  touch-action: none;
  position: fixed;
  width: 100%;
  height: 100%;
}

canvas {
  display: block;
  background: #87CEEB;
  touch-action: none;
}

#ui {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
}

.hud {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(0, 0, 0, 0.8);
  padding: 15px 20px;
  border-radius: 12px;
  color: white;
  font-size: 18px;
  font-weight: bold;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(10px);
}

.hud-item {
  margin: 8px 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.hud-icon {
  font-size: 24px;
}

.hud-value {
  color: #FFD700;
  font-size: 20px;
}

.fuel-container {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 200px;
}

.fuel-label {
  color: white;
  font-weight: bold;
  margin-bottom: 5px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

.fuel-bar {
  width: 100%;
  height: 30px;
  background: rgba(0, 0, 0, 0.7);
  border: 3px solid white;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.fuel-fill {
  height: 100%;
  background: linear-gradient(to right, #ff4444, #ffaa00, #44ff44);
  transition: width 0.3s ease;
  position: relative;
}

.fuel-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.fuel-fill.low {
  animation: fuelFlash 0.5s infinite;
}

@keyframes fuelFlash {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.fuel-warning {
  position: absolute;
  top: 70px;
  right: 20px;
  background: rgba(255, 68, 68, 0.9);
  color: white;
  padding: 10px 20px;
  border-radius: 10px;
  font-weight: bold;
  animation: warningPulse 1s infinite;
  display: none;
}

.fuel-warning.show {
  display: block;
}

@keyframes warningPulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.8; }
}

.top-controls {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  pointer-events: auto;
}

.control-btn {
  width: 50px;
  height: 50px;
  background: rgba(0, 0, 0, 0.7);
  border: 3px solid white;
  border-radius: 12px;
  color: white;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  backdrop-filter: blur(10px);
}

.control-btn:active {
  transform: scale(0.95);
  background: rgba(0, 0, 0, 0.9);
}

.speedometer {
  position: absolute;
  bottom: 30px;
  right: 30px;
  width: 120px;
  height: 120px;
  background: radial-gradient(circle, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.95));
  border-radius: 50%;
  border: 4px solid #FFD700;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
  pointer-events: none;
}

.speed-value {
  font-size: 32px;
  font-weight: bold;
  color: #00ff88;
  text-shadow: 0 0 10px #00ff88;
}

.speed-unit {
  font-size: 14px;
  color: #aaa;
  margin-top: -5px;
}

.speed-bars {
  position: absolute;
  bottom: 180px;
  right: 30px;
  display: flex;
  gap: 5px;
  pointer-events: none;
}

.speed-bar {
  width: 8px;
  height: 40px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  transition: background 0.2s;
}

.speed-bar.active {
  background: linear-gradient(to top, #ff4444, #ffaa00, #44ff44);
  box-shadow: 0 0 10px rgba(68, 255, 68, 0.5);
}

.touch-controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  display: none;
  pointer-events: auto;
}

.touch-controls.show {
  display: block;
}

.touch-btn {
  position: absolute;
  width: 120px;
  height: 120px;
  background: rgba(0, 0, 0, 0.6);
  border: 4px solid rgba(255, 255, 255, 0.8);
  border-radius: 50%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 16px;
  font-weight: bold;
  user-select: none;
  transition: all 0.1s;
  backdrop-filter: blur(10px);
}

.touch-btn.active {
  background: rgba(76, 175, 80, 0.8);
  transform: scale(0.95);
  border-color: #4CAF50;
}

.touch-btn-icon {
  font-size: 36px;
  margin-bottom: 5px;
}

#accelBtn {
  bottom: 40px;
  right: 40px;
}

#brakeBtn {
  bottom: 40px;
  left: 40px;
}

#restartTouchBtn {
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  width: 100px;
  height: 100px;
  display: none;
}

.milestone {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, #FFD700, #FFA500);
  color: #000;
  padding: 25px 50px;
  border-radius: 20px;
  font-size: 32px;
  font-weight: bold;
  box-shadow: 0 10px 40px rgba(255, 215, 0, 0.6);
  animation: milestoneAnim 2s ease-out forwards;
  pointer-events: none;
  z-index: 100;
}

@keyframes milestoneAnim {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.5);
  }
  20% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.2);
  }
  80% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
}

.countdown {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 120px;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
  animation: countdownPulse 1s ease-out;
  pointer-events: none;
  z-index: 100;
}

@keyframes countdownPulse {
  0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
  50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

.pause-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  z-index: 50;
}

.pause-overlay.show {
  display: flex;
}

.pause-content {
  background: rgba(30, 30, 30, 0.95);
  padding: 40px 60px;
  border-radius: 20px;
  text-align: center;
  color: white;
}

.pause-content h1 {
  font-size: 48px;
  margin-bottom: 30px;
}

.pause-btn {
  margin: 10px;
  padding: 15px 40px;
  font-size: 20px;
  background: linear-gradient(135deg, #4CAF50, #388E3C);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
  pointer-events: auto;
}

.pause-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
}

.settings-panel {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(30, 30, 30, 0.98);
  padding: 30px;
  border-radius: 20px;
  color: white;
  display: none;
  pointer-events: auto;
  z-index: 60;
  max-width: 400px;
  width: 90%;
}

.settings-panel.show {
  display: block;
}

.settings-title {
  font-size: 28px;
  font-weight: bold;
  margin-bottom: 20px;
  text-align: center;
}

.settings-item {
  margin: 20px 0;
}

.settings-label {
  font-size: 16px;
  margin-bottom: 10px;
  display: block;
}

.settings-buttons {
  display: flex;
  gap: 10px;
}

.settings-option {
  flex: 1;
  padding: 10px;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  color: white;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s;
}

.settings-option.active {
  background: rgba(76, 175, 80, 0.5);
  border-color: #4CAF50;
}

.settings-close {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  background: #ff4444;
  border: none;
  border-radius: 8px;
  color: white;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

.game-over {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.95);
  padding: 40px 60px;
  border-radius: 20px;
  text-align: center;
  color: white;
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
  display: none;
  pointer-events: auto;
}

.game-over.show {
  display: block;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
  to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

.game-over h1 {
  font-size: 48px;
  margin-bottom: 20px;
  color: #ff4444;
}

.game-over p {
  font-size: 24px;
  margin: 10px 0;
  color: #FFD700;
}

.game-over button {
  margin-top: 30px;
  padding: 15px 40px;
  font-size: 20px;
  background: linear-gradient(135deg, #4CAF50, #388E3C);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.game-over button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
}

@media (max-width: 768px) {
  .hud {
    font-size: 14px;
    padding: 10px 15px;
  }
  
  .speedometer {
    width: 90px;
    height: 90px;
    bottom: 180px;
  }
  
  .speed-value {
    font-size: 24px;
  }
  
  .fuel-container {
    width: 150px;
  }
  
  .milestone {
    font-size: 24px;
    padding: 20px 40px;
  }
  
  .countdown {
    font-size: 80px;
  }
}

@media (max-width: 480px) {
  .hud {
    font-size: 12px;
    padding: 8px 12px;
    top: 10px;
    left: 10px;
  }
  
  .fuel-container {
    width: 120px;
    top: 10px;
    right: 10px;
  }
  
  .top-controls {
    top: 10px;
  }
  
  .control-btn {
    width: 40px;
    height: 40px;
    font-size: 20px;
  }
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="ui">
  <div class="top-controls">
    <button class="control-btn" id="pauseBtn" title="Pause (P)">‚è∏Ô∏è</button>
    <button class="control-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
    <button class="control-btn" id="muteBtn" title="Mute">üîä</button>
    <button class="control-btn" id="fullscreenBtn" title="Fullscreen">‚õ∂</button>
  </div>

  <div class="hud">
    <div class="hud-item">
      <span class="hud-icon">üìè</span>
      <span>Distance: <span class="hud-value" id="distance">0</span>m</span>
    </div>
    <div class="hud-item">
      <span class="hud-icon">üí∞</span>
      <span>Coins: <span class="hud-value" id="coins">0</span></span>
    </div>
    <div class="hud-item">
      <span class="hud-icon">üèÜ</span>
      <span>Best: <span class="hud-value" id="best">0</span>m</span>
    </div>
  </div>

  <div class="fuel-container">
    <div class="fuel-label">‚õΩ Fuel</div>
    <div class="fuel-bar">
      <div class="fuel-fill" id="fuelFill"></div>
    </div>
  </div>

  <div class="fuel-warning" id="fuelWarning">‚ö†Ô∏è LOW FUEL!</div>

  <div class="speedometer">
    <div class="speed-value" id="speedValue">0</div>
    <div class="speed-unit">km/h</div>
  </div>
  
  <div class="speed-bars" id="speedBars">
    <div class="speed-bar"></div>
    <div class="speed-bar"></div>
    <div class="speed-bar"></div>
    <div class="speed-bar"></div>
    <div class="speed-bar"></div>
  </div>

  <div class="touch-controls" id="touchControls">
    <div class="touch-btn" id="accelBtn">
      <div class="touch-btn-icon">‚¨ÜÔ∏è</div>
      <div>GAS</div>
    </div>
    <div class="touch-btn" id="brakeBtn">
      <div class="touch-btn-icon">‚¨áÔ∏è</div>
      <div>BRAKE</div>
    </div>
    <div class="touch-btn" id="restartTouchBtn">
      <div class="touch-btn-icon">üîÑ</div>
      <div>RESTART</div>
    </div>
  </div>

  <div class="pause-overlay" id="pauseOverlay">
    <div class="pause-content">
      <h1>‚è∏Ô∏è PAUSED</h1>
      <button class="pause-btn" id="resumeBtn">‚ñ∂Ô∏è Resume</button>
      <button class="pause-btn" id="restartPauseBtn">üîÑ Restart</button>
    </div>
  </div>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-title">‚öôÔ∏è Settings</div>
    
    <div class="settings-item">
      <div class="settings-label">Quality:</div>
      <div class="settings-buttons">
        <div class="settings-option" data-quality="low">LOW</div>
        <div class="settings-option active" data-quality="high">HIGH</div>
      </div>
    </div>
    
    <div class="settings-item">
      <div class="settings-label">Camera Smoothing:</div>
      <div class="settings-buttons">
        <div class="settings-option" data-camera="tight">TIGHT</div>
        <div class="settings-option active" data-camera="normal">NORMAL</div>
        <div class="settings-option" data-camera="loose">LOOSE</div>
      </div>
    </div>
    
    <button class="settings-close" id="settingsClose">Close</button>
  </div>

  <div class="game-over" id="gameOver">
    <h1 id="gameOverTitle">‚õΩ Game Over!</h1>
    <p>Distance: <span id="finalDistance">0</span>m</p>
    <p>Coins: <span id="finalCoins">0</span></p>
    <button id="restartBtn">üîÑ Play Again</button>
  </div>
</div>

<script>
const CONFIG = {
  GRAVITY: 0.8,
  FRONT_WHEEL_RADIUS: 18,
  REAR_WHEEL_RADIUS: 22,
  CAR_WIDTH: 110,
  CAR_HEIGHT: 35,
  ACCELERATION: 0.6,
  BRAKE_FORCE: 0.5,
  MAX_SPEED: 16,
  TERRAIN_SEGMENT: 35,
  SUSPENSION_STRENGTH: 0.5,
  SUSPENSION_DAMPING: 0.75,
  MAX_FUEL: 100,
  FUEL_CONSUMPTION: 0.012,
  COIN_RADIUS: 12,
  COIN_VALUE: 10,
  FUEL_PICKUP_VALUE: 25,
  FLIP_ANGLE_THRESHOLD: 2.0,
  FLIP_TIME_LIMIT: 1500,
  OUT_OF_MAP_THRESHOLD: 1000,
  CHUNK_SIZE: 20,
  TERRAIN_WINDOW: 100
};

class Settings {
  constructor() {
    this.quality = localStorage.getItem('quality') || 'high';
    this.camera = localStorage.getItem('camera') || 'normal';
    this.muted = localStorage.getItem('muted') === 'true';
    this.cameraValues = { tight: 0.15, normal: 0.08, loose: 0.04 };
  }
  getCameraSmoothing() { return this.cameraValues[this.camera]; }
  getParticleMultiplier() { return this.quality === 'high' ? 1 : 0.3; }
  save() {
    localStorage.setItem('quality', this.quality);
    localStorage.setItem('camera', this.camera);
    localStorage.setItem('muted', this.muted);
  }
}

class AudioSystem {
  constructor() {
    this.context = null;
    this.enabled = true;
    this.engineGain = null;
    this.engineOsc = null;
    this.init();
  }
  init() {
    try {
      this.context = new (window.AudioContext || window.webkitAudioContext)();
      this.engineGain = this.context.createGain();
      this.engineGain.connect(this.context.destination);
      this.engineGain.gain.value = 0;
    } catch (e) {
      this.enabled = false;
    }
  }
  startEngine() {
    if (!this.enabled || !this.context) return;
    this.engineOsc = this.context.createOscillator();
    this.engineOsc.type = 'sawtooth';
    this.engineOsc.frequency.value = 80;
    this.engineOsc.connect(this.engineGain);
    this.engineOsc.start();
  }
  updateEngine(speed) {
    if (!this.enabled || !this.engineOsc) return;
    const freq = 80 + speed * 15;
    const volume = Math.min(speed * 0.03, 0.15);
    this.engineOsc.frequency.setTargetAtTime(freq, this.context.currentTime, 0.05);
    this.engineGain.gain.setTargetAtTime(volume, this.context.currentTime, 0.1);
  }
  stopEngine() {
    if (!this.enabled || !this.engineOsc) return;
    this.engineGain.gain.setTargetAtTime(0, this.context.currentTime, 0.3);
    setTimeout(() => {
      if (this.engineOsc) {
        this.engineOsc.stop();
        this.engineOsc = null;
      }
    }, 500);
  }
  playCoin() {
    if (!this.enabled || !this.context) return;
    const osc = this.context.createOscillator();
    const gain = this.context.createGain();
    osc.connect(gain);
    gain.connect(this.context.destination);
    osc.frequency.value = 800;
    osc.type = 'sine';
    gain.gain.value = 0.2;
    osc.start();
    osc.frequency.exponentialRampToValueAtTime(1200, this.context.currentTime + 0.1);
    gain.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.15);
    osc.stop(this.context.currentTime + 0.15);
  }
  playFuelPickup() {
    if (!this.enabled || !this.context) return;
    const osc = this.context.createOscillator();
    const gain = this.context.createGain();
    osc.connect(gain);
    gain.connect(this.context.destination);
    osc.frequency.value = 300;
    osc.type = 'square';
    gain.gain.value = 0.15;
    osc.start();
    osc.frequency.exponentialRampToValueAtTime(600, this.context.currentTime + 0.2);
    gain.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.25);
    osc.stop(this.context.currentTime + 0.25);
  }
  playLand() {
    if (!this.enabled || !this.context) return;
    const osc = this.context.createOscillator();
    const gain = this.context.createGain();
    osc.connect(gain);
    gain.connect(this.context.destination);
    osc.frequency.value = 150;
    osc.type = 'sawtooth';
    gain.gain.value = 0.1;
    osc.start();
    osc.frequency.exponentialRampToValueAtTime(50, this.context.currentTime + 0.1);
    gain.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.15);
    osc.stop(this.context.currentTime + 0.15);
  }
}

class Random {
  constructor(seed) { this.seed = seed; }
  next() {
    this.seed = (this.seed * 9301 + 49297) % 233280;
    return this.seed / 233280;
  }
}

function vibrate(duration) {
  if (navigator.vibrate) navigator.vibrate(duration);
}

class ParticleSystem {
  constructor(settings) {
    this.particles = [];
    this.settings = settings;
  }
  emit(x, y, count, type = 'dust') {
    const multiplier = this.settings.getParticleMultiplier();
    count = Math.ceil(count * multiplier);
    for (let i = 0; i < count; i++) {
      this.particles.push({
        x: x + (Math.random() - 0.5) * 10,
        y: y + (Math.random() - 0.5) * 10,
        vx: (Math.random() - 0.5) * (type === 'spark' ? 8 : 4),
        vy: -Math.random() * (type === 'spark' ? 6 : 3),
        life: 1,
        maxLife: type === 'spark' ? 0.5 : 1,
        size: type === 'spark' ? 3 + Math.random() * 2 : 2 + Math.random() * 4,
        type: type,
        color: type === 'spark' ? `hsl(${30 + Math.random() * 30}, 100%, 60%)` : 'rgba(139, 115, 85, 0.8)'
      });
    }
  }
  update() {
    for (let i = this.particles.length - 1; i >= 0; i--) {
      const p = this.particles[i];
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.4;
      p.life -= 0.02;
      if (p.life <= 0) this.particles.splice(i, 1);
    }
  }
  render(ctx, camera) {
    ctx.save();
    ctx.translate(-camera.x, -camera.y);
    this.particles.forEach(p => {
      const alpha = p.life / p.maxLife;
      if (p.type === 'spark') {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = alpha;
      } else {
        ctx.fillStyle = `rgba(139, 115, 85, ${alpha * 0.8})`;
      }
      ctx.fillRect(p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
    });
    ctx.restore();
  }
}

class CloudSystem {
  constructor(canvasWidth, canvasHeight) {
    this.clouds = [];
    this.generateClouds(canvasWidth, canvasHeight);
  }
  generateClouds(width, height) {
    const rng = new Random(54321);
    for (let i = 0; i < 12; i++) {
      this.clouds.push({
        x: rng.next() * width * 3,
        y: rng.next() * height * 0.4 + 50,
        size: 50 + rng.next() * 80,
        speed: 0.08 + rng.next() * 0.15,
        opacity: 0.6 + rng.next() * 0.3
      });
    }
  }
  update(camera, canvasWidth) {
    this.clouds.forEach(cloud => {
      cloud.x += cloud.speed;
      if (cloud.x > camera.x + canvasWidth + 200) {
        cloud.x = camera.x - 200;
      }
    });
  }
  render(ctx, camera) {
    ctx.save();
    ctx.translate(-camera.x * 0.3, 0);
    this.clouds.forEach(cloud => {
      ctx.fillStyle = `rgba(255, 255, 255, ${cloud.opacity})`;
      ctx.beginPath();
      ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
      ctx.arc(cloud.x + cloud.size * 0.7, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
      ctx.arc(cloud.x + cloud.size * 1.4, cloud.y, cloud.size * 0.6, 0, Math.PI * 2);
      ctx.fill();
    });
    ctx.restore();
  }
}

class ParallaxBackground {
  constructor(canvasWidth, canvasHeight) {
    this.mountains = [];
    this.generateMountains(canvasWidth, canvasHeight);
  }
  generateMountains(width, height) {
    const rng = new Random(11111);
    for (let i = 0; i < 8; i++) {
      const baseY = height * 0.6;
      const peaks = [];
      for (let j = 0; j < 5; j++) {
        peaks.push({
          x: (i * width / 4) + (j * width / 20),
          y: baseY - rng.next() * 150
        });
      }
      this.mountains.push({ peaks, opacity: 0.3 + rng.next() * 0.2 });
    }
  }
  render(ctx, camera, canvasHeight) {
    ctx.save();
    ctx.translate(-camera.x * 0.15, 0);
    this.mountains.forEach(mountain => {
      ctx.fillStyle = `rgba(60, 60, 80, ${mountain.opacity})`;
      ctx.beginPath();
      ctx.moveTo(mountain.peaks[0].x, canvasHeight);
      mountain.peaks.forEach(peak => {
        ctx.lineTo(peak.x, peak.y);
      });
      ctx.lineTo(mountain.peaks[mountain.peaks.length - 1].x + 200, canvasHeight);
      ctx.closePath();
      ctx.fill();
    });
    ctx.restore();
  }
}

class InfiniteTerrain {
  constructor() {
    this.chunks = new Map();
    this.rng = new Random(12345);
  }
  getChunkKey(chunkIndex) {
    return chunkIndex;
  }
  generateChunk(chunkIndex) {
    const points = [];
    const baseY = 400;
    const startX = chunkIndex * CONFIG.CHUNK_SIZE * CONFIG.TERRAIN_SEGMENT;
    const rng = new Random(12345 + chunkIndex * 1000);
    
    for (let i = 0; i < CONFIG.CHUNK_SIZE; i++) {
      const globalIndex = chunkIndex * CONFIG.CHUNK_SIZE + i;
      const x = startX + i * CONFIG.TERRAIN_SEGMENT;
      const wave1 = Math.sin(globalIndex * 0.025) * 120;
      const wave2 = Math.sin(globalIndex * 0.06) * 70;
      const wave3 = Math.cos(globalIndex * 0.1) * 45;
      const noise = (rng.next() - 0.5) * 30;
      const y = baseY + wave1 + wave2 + wave3 + noise;
      points.push({ x, y
